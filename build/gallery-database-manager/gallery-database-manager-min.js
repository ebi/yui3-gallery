YUI.add("gallery-database-manager",function(b){var h="DatabaseManager",e=b.Lang,c=e.isString,i="1",p="yuiGalleryKeyValueStore",m="disabled",d="dbHandle",o="databaseName",a="databaseDescription",k="databaseSize",n="defaultLifetime",g="checkLifetime",f="dbDisabledPropertyName";function j(l,q){if(e.isUndefined(l)){}else{}if(e.isUndefined(q)){}else{}}b.DatabaseManager=b.Base.create(h,b.Base,[],{initializer:function(q){q=q||{};var l=null;if(this._allowsDBAccess()){try{l=openDatabase(this.get(o),"",this.get(a),this.get(k));if(l.version!==i){if(""===l.version){l.changeVersion(l.version,i,function(s){s.executeSql("CREATE TABLE "+p+" (id TEXT PRIMARY KEY, value BLOB, timeWritten INTEGER, lifetime INTEGER);");},function(){},j);}}}catch(r){this._disableDBAccess();}}this._set(d,l);},setItem:function(r,s,l){if(!this.get(d)){return;}l=l||this.get(n);var q=[r,s,Date.now(),l];this.get(d).transaction(function(t){t.executeSql("REPLACE INTO "+p+" (id, value, timeWritten, lifetime) VALUES (:id, :value, :timeWritten, :lifetime);",q,null,j);});},getItem:function(l,r,q){if(!this.get(d)){r.call(r,null);return;}q=b.Lang.isUndefined(q)?this.get(g):q;this.get(d).transaction(function(s){s.executeSql("SELECT * FROM "+p+" WHERE id = :key;",[l],function(t,u){if(0===u.rows.length){r.call(r,null);return;}var v=u.rows.item(0),w=Date.now();if(q&&0<v.lifetime&&w>(w+v.lifetime)){r.call(r,null);return;}r.call(r,v.value);},j);});},_disableDBAccess:function(){var l=this.get(f);try{localStorage.setItem(l,m);}catch(q){b.Cookie.set(l,m);}},_allowsDBAccess:function(){if(!!window.openDatabase){try{if(null===localStorage.getItem(this.get(f))){return this._allowsDBAccessByCookie();}else{return false;}}catch(l){return this._allowsDBAccessByCookie();}}return false;},_allowsDBAccessByCookie:function(){if(null===b.Cookie.get(this.get(f))){return true;}return false;}},{ATTRS:{dbHandle:{readOnly:true},databaseName:{value:h,validator:c,writeOnce:"initOnly"},databaseTableName:{value:"keyValueStore",validator:c,writeOnce:"initOnly"},databaseSize:{value:5*1024*1024,validator:e.isNumber,writeOnce:"initOnly"},databaseDescription:{value:"Default YUI3 Gallery DatabaseManager Database",validator:c,writeOnce:"initOnly"},defaultLifetime:{value:0,validator:e.isNumber},checkLifetime:{value:true,validator:e.isBoolean},dbDisabledPropertyName:{value:h+"disabledDB"}}});},"@VERSION@",{requires:["base","cookie"]});