YUI.add("gallery-database-manager",function(b){var h="DatabaseManager",e=b.Lang,c=e.isString,i="1",r="yuiGalleryKeyValueStore",m="disabled",d="dbHandle",o="databaseName",a="databaseDescription",k="databaseSize",n="defaultLifetime",g="checkLifetime",f="dbDisabledPropertyName",p="allowsAccess",q="supportsDB";function j(l,s){if(e.isUndefined(l)){}else{}if(e.isUndefined(s)){}else{}}b.DatabaseManager=b.Base.create(h,b.Base,[],{initializer:function(s){s=s||{};var l=null;if(this.get(p)){try{l=openDatabase(this.get(o),"",this.get(a),this.get(k));if(l.version!==i){if(""===l.version){l.changeVersion(l.version,i,function(u){u.executeSql("CREATE TABLE "+r+" (id TEXT PRIMARY KEY, value BLOB, timeWritten INTEGER, lifetime INTEGER);");},function(){},j);}}}catch(t){this._disableDBAccess();}}this._set(d,l);},setItem:function(t,u,l){if(!this.get(d)){return;}l=l||this.get(n);var s=[t,u,Date.now(),l];this.get(d).transaction(function(v){v.executeSql("REPLACE INTO "+r+" (id, value, timeWritten, lifetime) VALUES (:id, :value, :timeWritten, :lifetime);",s,null,j);});},getItem:function(l,t,s){if(!this.get(d)){t.call(t,null);return;}s=b.Lang.isUndefined(s)?this.get(g):s;this.get(d).transaction(function(u){u.executeSql("SELECT * FROM "+r+" WHERE id = :key;",[l],function(v,w){if(0===w.rows.length){t.call(t,null);return;}var x=w.rows.item(0),y=Date.now();if(s&&0<x.lifetime&&y>(y+x.lifetime)){t.call(t,null);return;}t.call(t,x.value);},j);});},_disableDBAccess:function(){var l=this.get(f);this._set(p,false);try{localStorage.setItem(l,m);}catch(s){b.Cookie.set(l,m);}},_supportsDB:function(){return !!window.openDatabase;},_allowsDBAccess:function(){if(this.get(q)){try{if(null===localStorage.getItem(this.get(f))){return this._allowsDBAccessByCookie();}else{return false;}}catch(l){return this._allowsDBAccessByCookie();}}return false;},_allowsDBAccessByCookie:function(){if(null===b.Cookie.get(this.get(f))){return true;}return false;}},{ATTRS:{dbHandle:{readOnly:true},databaseName:{value:h,validator:c,writeOnce:"initOnly"},databaseTableName:{value:"keyValueStore",validator:c,writeOnce:"initOnly"},databaseSize:{value:5*1024*1024,validator:e.isNumber,writeOnce:"initOnly"},databaseDescription:{value:"Default YUI3 Gallery DatabaseManager Database",validator:c,writeOnce:"initOnly"},defaultLifetime:{value:0,validator:e.isNumber},checkLifetime:{value:true,validator:e.isBoolean},dbDisabledPropertyName:{value:h+"disabledDB"},allowsAccess:{valueFn:"_allowsDBAccess",readOnly:true},supportsDB:{valueFn:"_supportsDB",readOnly:true}}});},"@VERSION@",{requires:["base","cookie"]});