YUI.add("gallery-dispatcher",function(C){var J=C.ClassNameManager.getClassName,M="dispatcher",U="script",X="fetch",T="purge",E="beforeExecute",W="load",R="ready",A="error",I="uri",F="content",G="autopurge",Q="loading",S="node",H="normalize",B=/<\s*body.*?>(.*?)<\/\s*?body[^>\w]*?>/i,V=/<\s*head.*?>(.*?)<\/\s*?head[^>\w]*?>/i,D=J(M,"loading"),K=C.Lang,N=K.isBoolean,O=K.isString;function Z(d,L){var a=C.Node.create("<div></div>"),c=a.cloneNode(),e={},Y=null,b="";if(L&&(Y=V.exec(d))){a.setContent(Y[1]).all(U+",style,link").each(function(f){c.append(f);});b=c.get("innerHTML");}a.setContent(b+((Y=B.exec(d))?Y[1]:d));e.js=a.all(U).each(function(f){f.get("parentNode").removeChild(f);});e.content=a.get("innerHTML");return e;}function P(a,L,Y){if(L&&L.on&&L.on[a]){L.on[a].apply(L.context||C,Y);}}C.Dispatcher=C.Base.create(M,C.Base,[],{_queue:null,_io:null,initializer:function(Y){var L=this;Y=Y||{};L._queue=new C.AsyncQueue();L.after(F+"Change",function(a){L._dispatch(a.newVal);});L.after(I+"Change",function(a){L._fetch(a.newVal);});if(Y[F]){L._dispatch(L.get(F));}if(Y[I]){L._fetch(L.get(I));}},destructor:function(){var L=this;L.stop();L._queue=null;L._io=null;},_executeScript:function(c,a){var b=(a?a.get("ownerDocument"):null)||C.one("doc"),Y=b.one("head")||b.get("documentElement"),L=C.one(document.createElement(U));if(c){L._node.text=c;}Y.appendChild(L);L.remove();if(a){a.remove();}},_getScript:function(b,Y){var L=this,a=L._queue;C.Get.script(b,{autopurge:true,onFailure:function(c){L.fire(A,c);},onEnd:function(c){if(a){a.run();}}});},_setContent:function(L){var Y=this.get(S);Y.setContent(L);},_purgeContent:function(){var L=this.get(S);L.get("children").each(function(Y){Y.purge(true);});},_dispatch:function(Y){var L=this,b=Z(Y,L.get(H)),a=L._queue,c=L.get(S);L.stop();if(!c){return;}if(L.get(G)){a.add({fn:function(){L._purgeContent();L.fire(T,c);}});}a.add({fn:function(){L._setContent(b.content);L.fire(E,c);}});b.js.each(function(d){if(d&&d.get("src")){a.add({fn:C.bind(L._getScript,L,d.get("src"),d),autoContinue:false});}else{a.add({fn:C.bind(L._executeScript,L,d._node.text,d)});}});a.add({fn:function(){L.fire(R);}});L._queue.run();},_fetch:function(b){var L=this,a=L.get("ioConfig")||{},Y;L.stop();if(!b){return false;}Y=C.merge({method:"GET"},a);Y.on={start:function(){L._set(Q,true);P("start",a,arguments);},success:function(c,d){L.set(F,d.responseText);P("success",a,arguments);},failure:function(c,d){P("failure",a,arguments);L.fire(A,d);},end:function(){L._set(Q,false);P("end",a,arguments);}};Y.context=L;return(L._io=C.io(b,Y));},stop:function(){var L=this;L._queue.stop();if(L._io){L._io.abort();}return L;}},{EVENT_PREFIX:M,ATTRS:{node:{value:null,setter:function(L){this.stop();return C.one(L);}},autopurge:{value:true,validator:N},normalize:{value:false,validator:N},uri:{value:null,validator:function(L){return(L&&O(L)&&(L!==""));}},content:{value:"",validator:O},loading:{value:false,validator:N,readOnly:true,setter:function(Y){var L=this;if(Y){L.fire(X);L.get(S).addClass(D);}else{L.fire(W);L.get(S).removeClass(D);}return Y;}},ioConfig:{value:null}}});},"@VERSION@",{requires:["base","node-base","io-base","get","async-queue","classnamemanager"]});